# geo-service

## Алгоритмы генерации данных
### Генерация меток пользователей
Метка - пара чисел, широта и долгота. Самый простой способ генерации тестового набора меток - из равномерных распределений (от -180 градусов до +180 градусов для долготы и от -90 градусов до +90 градусов для широты). Недостаток такого способа - разная плотность меток в разных широтах, самая низкая - на экваторе, а самая высокая - на полюсах. То есть, при самом примитивном подходе, мы посредством равномерных распределений размечаем земной шар метками неравномерно. Неинтересно.

Будем генерировать метки так, чтобы они были равномерно распределены по земной поверхности. Долготу будем генерировать из равномерного распределения. Генерация широты посложнее.

Обозначим R - радиус земного шара, lat - широта в радианах (варьируется от -Pi/2 до +Pi/2). Разберем алгоритм генерации широты для точек северного полушария. В южном полушарии изменится лишь знак lat.

Длина параллели широты lat: L(lat) = 2 * Pi * R * sin(lat). 
     
Эта фукнция убывает от 2 * Pi * R на экваторе до 0 на северном полюсе. Эта фукнция определяет закон убывания вероятности появления метки на широте lat. 

Чтобы получить функцию плотности вероятности f(lat), L(lat) нужно нормировать, поделив на интеграл L(lat) на отрезке [0, Pi/2]. Обозначим этот интеграл I. 

Фукнция плотности вероятности генерации метки на широте lat: f(lat) = 2 * Pi * R * sin(lat) / I. 

Для генерации распределения с плотностью f, необходима обратная фукнция lat(f) = arcsin(I * f / (2 * Pi * R)). 

Диапазон изменения f - от 0 до f(0) = 2 * Pi * R / I. Обозначим r - равномерно распределенная случайная величина из отрезка от 0 до 1. 

Тогда алгоритм генерации широты: lat = arcsin(I * (r * 2 * Pi / I) / (2 * Pi * R)) = arcsin(r).

Итак, алгоритм генерации набора меток, равномерно распределенных по земной поверхности:
N - общее число меток
rand - фукнция генерации случайного числа из равномерного распределения от 0 до 1
arcsin - функция вычисления арксинуса
users - список меток в формате userId;latitude;longitude
i = 0
while i < N:
  lon = rand * 360 - 180
  lat = arcsin(rand)
  if i < N / 2:
    lat = -lat
  users += [(i,lat,lon)]

### Генерация географической сетки
