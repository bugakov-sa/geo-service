# geo-service

## Алгоритмы генерации данных
Реализованы на python 2.7. [/script](https://github.com/bugakov-sa/geo-service/blob/master/script)
### Генерация меток пользователей
Метка - пара чисел, широта и долгота. Самый простой способ генерации тестового набора меток - из равномерных распределений (от -180 градусов до +180 градусов для долготы и от -90 градусов до +90 градусов для широты). Недостаток такого способа - разная плотность меток в разных широтах, самая низкая - на экваторе, а самая высокая - на полюсах. То есть, при самом примитивном подходе, мы посредством равномерных распределений размечаем земной шар метками неравномерно. Неинтересно.

Будем генерировать метки так, чтобы они были равномерно распределены по земной поверхности. Долготу будем генерировать из равномерного распределения. Генерация широты посложнее.

Обозначим R - радиус земного шара, lat - широта в радианах (варьируется от -Pi/2 до +Pi/2). Разберем алгоритм генерации широты для точек северного полушария. В южном полушарии изменится лишь знак lat.

Длина параллели широты lat: L(lat) = 2 * Pi * R * sin(lat). 
     
Эта фукнция убывает от 2 * Pi * R на экваторе до 0 на северном полюсе. Эта фукнция определяет закон убывания вероятности появления метки на широте lat. 

Чтобы получить функцию плотности вероятности f(lat), L(lat) нужно нормировать, поделив на интеграл L(lat) на отрезке [0, Pi/2]. Обозначим этот интеграл I. 

Фукнция плотности вероятности генерации метки на широте lat: f(lat) = 2 * Pi * R * sin(lat) / I. 

Для генерации распределения с плотностью f, необходима обратная фукнция lat(f) = arcsin(I * f / (2 * Pi * R)). 

Диапазон изменения f - от 0 до f(0) = 2 * Pi * R / I. Обозначим r - равномерно распределенная случайная величина из отрезка от 0 до 1. 

Тогда алгоритм генерации широты метки в серверном полушарии: lat = arcsin(I * (r * 2 * Pi / I) / (2 * Pi * R)) = arcsin(r).

Алгоритм генерации меток пользователей реализован в двух вариантах:

1. [users.py](https://github.com/bugakov-sa/geo-service/blob/master/script/users.py) - генерация таблицы для геосервиса. Создает csv-файл [users.csv](https://github.com/bugakov-sa/geo-service/blob/master/data/users.csv) с колонками: ИД пользователя, широта, долгота.

2. [points.py](https://github.com/bugakov-sa/geo-service/blob/master/script/points.py) - генерация тестового набора точек для визуализации с помощью сервиса [mapcustomizer](https://www.mapcustomizer.com/). Создает csv-файл [ponts.csv](https://github.com/bugakov-sa/geo-service/blob/master/data/users.csv) с колонками: широта, долгота. Содержимое этого файла можно скопировать в форму Bulk Entry (в правом верхнем углу на странице [mapcustomizer](https://www.mapcustomizer.com/)) Так мы можем визуально оценить, насколько случайно точки разбросаны по земной поверхности. Поскольку земная поверхность спроецирована на прямоугольную карту, плотность точек на такой карте уменьшается при движении от экватора к полюсам.

### Генерация географической сетки
Примитивный. В качестве опорных точек взяты точки с целочисленными координатами. Реализация алгоритма: [zones.py](https://github.com/bugakov-sa/geo-service/blob/master/script/zones.py). Результат работы алгоритма: [zones.csv](https://github.com/bugakov-sa/geo-service/blob/master/data/zones.csv)
